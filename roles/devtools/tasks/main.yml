---
- name: Ensure Node.js and npm are installed
  ansible.builtin.apt:
    name:
      - nodejs
      - npm
    state: present
    update_cache: yes
  become: true

- name: Install Podman
  ansible.builtin.apt:
    name: podman
    state: present
    update_cache: yes
  become: true

- name: Verify Podman installed
  ansible.builtin.command:
    cmd: podman --version
  changed_when: false
  register: podman_check
  ignore_errors: true
  become: false

- name: Install Distrobox via apt (Ubuntu package)
  ansible.builtin.apt:
    name: distrobox
    state: present
    update_cache: yes
  become: true
  when: podman_check.rc == 0

- name: Verify Distrobox is available
  ansible.builtin.command:
    cmd: distrobox --version
  changed_when: false
  register: distrobox_check
  ignore_errors: true
  become: false

- name: Inform if Distrobox not available
  ansible.builtin.debug:
    msg: "Distrobox installation failed or is unavailable"
  when: distrobox_check.rc != 0